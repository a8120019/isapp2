<!DOCTYPE html>

<html>

<head>
    <link rel="stylesheet" href="index.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <script type="text/javascript" src="lib/osql.js"></script>

    <script>
        var angle = 0;
        osql.requireLogin();

        $(document).ready(function () {
            makeList();
            showMovie();
        });

        async function makeList() {
            var me = await osql.getMe();
            document.getElementById('name').innerHTML = me.fname;
            var fingering_id = Number(sessionStorage.getItem('store_id'));
            var html = "<table border='1'>";
            var key_list = ["Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P", "BackSpace", "A", "S", "D", "F", "G", "H", "J", "K", "L", ";", "Enter", "Z", "X", "C", "V", "B", "N", "M", ",", ".", "/", "Space"]
            for (var i = 0; i < 3; i++) {
                html = html + '<tr>';
                for (var j = 0; j < 11; j++) {
                    html = html + '<td>' + `<span id=char"${11 * i + j}">` + key_list[11 * i + j] + "</span>" + '</td>';
                }
                html = html + '</tr>';

                html = html + '<tr>';
                for (var j = 0; j < 11; j++) {
                    var sql = `select * from Key_Finger where id = ${fingering_id} AND text = "${key_list[11 * i + j]}";`;
                    var fingers = await osql.connect(sql);
                    console.log(fingers);
                    if (fingers[0].finger == null) {
                        html = html + '<td>' + `<span id=value${key_list[11 * i + j]}>` + "　" + "</span>" + '</td>';
                    } else {
                        html = html + '<td>' + `<span id=value${key_list[11 * i + j]}>` + fingers[0].finger + "</span>" + '</td>';
                    }
                }
                html = html + '</tr>';
            }
            html = html + '</table>';
            document.getElementById('result').innerHTML = html;
        }

        async function showMovie() {
            var fingering_id = Number(sessionStorage.getItem('store_id'));
            var sql = `select * from Fingering where fingerid = ${fingering_id};`;
            var objects = await osql.connect(sql);
            var before_rename = objects[0].movieURL;
            // document.getElementById('movie').innerHTML = before_rename.replace("view", "preview");
            var html = `<div id="movie_rotate_${angle}"><iframe seamless src="${before_rename.replace("view", "preview")}" width="704" height="396"></iframe></div>`
            document.getElementById('movie').innerHTML = html;
        }

        function rightRotate() {
            angle += 90;
            showMovie();
            if (angle == 360) {
                angle = 0
            }
        }

        function leftRotate() {
            angle -= 90;
            if (angle == -90) {
                angle = 270;
            }
            showMovie();
            if (angle == -360) {
                angle = 0
            }
        }
    </script>

</head>

<body>
    <h1><span id="name"></span>さんの個人記録</h1>
    <hr>
    <span id="result"></span>
    <br>
    <div id="movie"></div>
    <br>
    <span id="Rotation"><button onclick="rightRotate()">右回転</button>　　　<button
            onclick="leftRotate()">左回転</button></span>
    <hr>
    <a href="student.html">ホームに戻る</a>
</body>

</html>