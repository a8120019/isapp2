<!DOCTYPE html>

<html>

<head>
    <link rel="stylesheet" href="index.css">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <script type="text/javascript" src="lib/jquery.min.js"></script>
    <script type="text/javascript" src="lib/osql.js"></script>

    <script>

        $(document).ready(function () {
            test();
        });

        function test() {
            var html = "<table border='1'>";
            var key_list = ["Q", "W", "E", "R", "T", "Y", "U", "I", "O", "P", "BackSpace", "A", "S", "D", "F", "G", "H", "J", "K", "L", ";", "Enter", "Z", "X", "C", "V", "B", "N", "M", ",", ".", "/", "Space"]
            for (var i = 0; i < 3; i++) {
                html = html + '<tr>';
                for (var j = 0; j < 11; j++) {
                    html = html + '<td>' + `<input type="radio" id="char${11 * i + j}" name="characters" value="${key_list[11 * i + j]}" onclick="fingerButton(${11 * i + j}, '${key_list[11 * i + j]}')">` + key_list[11 * i + j] + '</td>';
                }
                html = html + '</tr>';

                html = html + '<tr>';
                for (var j = 0; j < 11; j++) {
                    html = html + '<td>' + "　" + '</td>';
                }
                html = html + '</tr>';
            }
            html = html + '</table>';
            document.getElementById('result').innerHTML = html;
        }

        function fingerButton(key_number, key_value){
            var html = "";
            var finger_list = ["左小指", "左薬指", "左中指", "左人差し指", "左親指", "右親指", "右人差し指", "右中指", "右薬指", "右小指"];
            var finger_values = [1, 2, 3, 4, 5, 6, 7, 8, 9, 0];
            for (var i = 0;i < finger_list.length;i++){
                html = html + `<input type="checkbox" id="${finger_list[i]}" name="fingers" value=${finger_values[i]} onclick="example(${key_number}, '${key_value}', '${finger_list[i]}')">` + finger_list[i] + "</button>";
                // html = html + `<input type="checkbox" id="${finger_list[i]}" name="fingers" value=${finger_values[i]} onclick="buttonPressed('${finger_list[i]}')">` + finger_list[i] + "</button>";
            }
            document.getElementById('finger').innerHTML = html;
        }

        function example(key_number, key_value, finger_value){
            console.log(finger_value + "で" + key_value + "が押されました");
        }

        async function buttonPressed(finger_name){
            var input_fingers = document.querySelectorAll("input[name=fingers]:checked");

            var instance = [];

            for (var checked_data of input_fingers) {
                instance.push(checked_data.value);
                // console.log(checked_data.value); // 1, 2, 5
            }
            console.log(instance);
            var sql = `update Key_Finger set finger = "${instance}" where id = 8 AND text = "Q";`;
            await osql.connect(sql);

            // let elements = document.getElementById(finger_name);
            // let len = elements.length;
            // let checkValue = '';
            // console.log(elements.value);

            // for (let i = 0; i < len; i++) {
            //     if (elements.item(i).checked) {
            //         checkValue = elements.item(i).value;
            //         console.log(checkValue);
            //     }
            // }
        }

        async function resetPressed(){
            var sql = `update Key_Finger set finger = null where id = 8;`;
            await osql.connect(sql);
        }

    </script>

</head>

<body>
    <h1>テストページ</h1>
    <span id="result"></span>
    <br>
    <span id="finger"></span>
    <br>
    <button id="check" onclick="buttonPressed()">ボタン</button>
    <br>
    <button id="reset" onclick="resetPressed()">リセット</button>

</body>

</html>